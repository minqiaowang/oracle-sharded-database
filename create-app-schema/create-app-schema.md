# Create Shard App Schema

## Introduction

In this lab, you will create a shard app schema. You will create a sharded table family `Customers->Orders->LineItems` sharded by `CustId`, and a duplicate table `Products`.

Estimated Lab Time: 10 minutes.

### Objectives

In this lab, you will perform the following steps:
- Create the schema user, tablespace set, sharded tables and duplicated tables
- Verify that the DDLs have been propagated to all the shards

### Prerequisites

This lab assumes you have already completed the following:
- Sharded Database Deployment


## **Step 1:** Create Shard App Schema

1. Login to the catalog database host, switch to oracle user, and make sure you are in the cata environment.

   ```
   $ ssh -i labkey opc@152.67.196.50
   Last login: Sun Nov 29 01:26:28 2020 from 59.66.120.23
   -bash: warning: setlocale: LC_CTYPE: cannot change locale (UTF-8): No such file or directory
   
   [opc@cata ~]$ sudo su - oracle
   Last login: Sun Nov 29 02:49:51 GMT 2020 on pts/0
   
   [oracle@cata ~]$ . ./cata.sh 
   [oracle@cata ~]$ 
   ```

   

2. Download the SQL scripts `create-app-schema.sql`.

   ```
   [oracle@cata ~]$ <copy>wget https://github.com/minqiaowang/oracle-sharded-database/raw/main/create-app-schema/create-app-schema.sql</copy>
   ```

   

3. Review the content in the sql scripts file.

   ```
   [oracle@cata ~]$ <copy>cat create-app-schema.sql</copy> 
   set echo on 
   set termout on
   set time on
   spool /home/oracle/create_app_schema.lst
   REM
   REM Connect to the Shard Catalog and Create Schema
   REM
   connect / as sysdba
   alter session set container=catapdb;
   alter session enable shard ddl;
   create user app_schema identified by app_schema;
   grant connect, resource, alter session to app_schema;
   grant execute on dbms_crypto to app_schema;
   grant create table, create procedure, create tablespace, create materialized view to app_schema;
   grant unlimited tablespace to app_schema;
   grant select_catalog_role to app_schema;
   grant all privileges to app_schema;
   grant gsmadmin_role to app_schema;
   grant dba to app_schema;
   
   
   REM
   REM Create a tablespace set for SHARDED tables
   REM
   CREATE TABLESPACE SET  TSP_SET_1 using template (datafile size 100m autoextend on next 10M maxsize unlimited extent management  local segment space management auto );
   
   REM
   REM Create a tablespace for DUPLICATED tables
   REM
   CREATE TABLESPACE products_tsp datafile size 100m autoextend on next 10M maxsize unlimited extent management local uniform size 1m; 
    
   REM
   REM Create Sharded and Duplicated tables
   REM
   connect app_schema/app_schema@catapdb
   alter session enable shard ddl;
   REM
   REM Create a Sharded table for Customers  (Root table)
   REM
   CREATE SHARDED TABLE Customers
   (
     CustId      VARCHAR2(60) NOT NULL,
     FirstName   VARCHAR2(60),
     LastName    VARCHAR2(60),
     Class       VARCHAR2(10),
     Geo         VARCHAR2(8),
     CustProfile VARCHAR2(4000),
     Passwd      RAW(60),
     CONSTRAINT pk_customers PRIMARY KEY (CustId),
     CONSTRAINT json_customers CHECK (CustProfile IS JSON)
   ) TABLESPACE SET TSP_SET_1
   PARTITION BY CONSISTENT HASH (CustId) PARTITIONS AUTO;
   
   REM
   REM Create a Sharded table for Orders
   REM
   CREATE SHARDED TABLE Orders
   (
     OrderId     INTEGER NOT NULL,
     CustId      VARCHAR2(60) NOT NULL,
     OrderDate   TIMESTAMP NOT NULL,
     SumTotal    NUMBER(19,4),
     Status      CHAR(4),
     constraint  pk_orders primary key (CustId, OrderId),
     constraint  fk_orders_parent foreign key (CustId) 
       references Customers on delete cascade
   ) partition by reference (fk_orders_parent);
   
   REM
   REM Create the sequence used for the OrderId column
   REM
   CREATE SEQUENCE Orders_Seq;
   
   REM
   REM Create a Sharded table for LineItems
   REM
   CREATE SHARDED TABLE LineItems
   (
     OrderId     INTEGER NOT NULL,
     CustId      VARCHAR2(60) NOT NULL,
     ProductId   INTEGER NOT NULL,
     Price       NUMBER(19,4),
     Qty         NUMBER,
     constraint  pk_items primary key (CustId, OrderId, ProductId),
     constraint  fk_items_parent foreign key (CustId, OrderId)
       references Orders on delete cascade
   ) partition by reference (fk_items_parent);
   
   REM
   REM Create Duplicated table for Products
   REM
   CREATE DUPLICATED TABLE Products
   (
     ProductId  INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
     Name       VARCHAR2(128),
     DescrUri   VARCHAR2(128),
     LastPrice  NUMBER(19,4)
   ) TABLESPACE products_tsp;
   
   REM
   REM Create functions for Password creation and checking â€“ used by the REM demo loader application
   REM
   
   CREATE OR REPLACE FUNCTION PasswCreate(PASSW IN RAW)
     RETURN RAW
   IS
     Salt RAW(8);
   BEGIN
     Salt := DBMS_CRYPTO.RANDOMBYTES(8);
     RETURN UTL_RAW.CONCAT(Salt, DBMS_CRYPTO.HASH(UTL_RAW.CONCAT(Salt, PASSW), DBMS_CRYPTO.HASH_SH256));
   END;
   /
   
   CREATE OR REPLACE FUNCTION PasswCheck(PASSW IN RAW, PHASH IN RAW)
     RETURN INTEGER IS
   BEGIN
     RETURN UTL_RAW.COMPARE(
         DBMS_CRYPTO.HASH(UTL_RAW.CONCAT(UTL_RAW.SUBSTR(PHASH, 1, 8), PASSW), DBMS_CRYPTO.HASH_SH256),
         UTL_RAW.SUBSTR(PHASH, 9));
   END;
   /
   
   REM
   REM
   select table_name from user_tables;
   REM
   REM
   spool off
   ```

   

4. Connect to the cata database with sysdba, run this sql scripts

   ```
   [oracle@cata ~]$ sqlplus / as sysdba
   
   SQL*Plus: Release 19.0.0.0.0 - Production on Mon Nov 30 01:26:03 2020
   Version 19.7.0.0.0
   
   Copyright (c) 1982, 2020, Oracle.  All rights reserved.
   
   
   Connected to:
   Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
   Version 19.7.0.0.0
   
   SQL> @create-app-schema.sql
   ```

   

5. The result screen like the following:

   ```
   SQL> set termout on
   SQL> set time on
   01:26:37 SQL> spool /home/oracle/create_app_schema.lst
   01:26:37 SQL> REM
   01:26:37 SQL> REM Connect to the Shard Catalog and Create Schema
   01:26:37 SQL> REM
   01:26:37 SQL> connect / as sysdba
   Connected.
   01:26:37 SQL> alter session set container=catapdb;
   
   Session altered.
   
   01:26:37 SQL> alter session enable shard ddl;
   
   Session altered.
   
   01:26:37 SQL> create user app_schema identified by app_schema;
   
   User created.
   
   01:26:37 SQL> grant connect, resource, alter session to app_schema;
   
   Grant succeeded.
   
   01:26:37 SQL> grant execute on dbms_crypto to app_schema;
   
   Grant succeeded.
   
   01:26:37 SQL> grant create table, create procedure, create tablespace, create materialized view to app_schema;
   
   Grant succeeded.
   
   01:26:37 SQL> grant unlimited tablespace to app_schema;
   
   Grant succeeded.
   
   01:26:37 SQL> grant select_catalog_role to app_schema;
   
   Grant succeeded.
   
   01:26:37 SQL> grant all privileges to app_schema;
   
   Grant succeeded.
   
   01:26:37 SQL> grant gsmadmin_role to app_schema;
   
   Grant succeeded.
   
   01:26:37 SQL> grant dba to app_schema;
   
   Grant succeeded.
   
   01:26:37 SQL> 
   01:26:37 SQL> 
   01:26:37 SQL> REM
   01:26:37 SQL> REM Create a tablespace set for SHARDED tables
   01:26:37 SQL> REM
   01:26:37 SQL> CREATE TABLESPACE SET  TSP_SET_1 using template (datafile size 100m autoextend on next 10M maxsize unlimited extent management	local segment space management auto );
   
   Tablespace created.
   
   01:26:39 SQL> 
   01:26:39 SQL> REM
   01:26:39 SQL> REM Create a tablespace for DUPLICATED tables
   01:26:39 SQL> REM
   01:26:39 SQL> CREATE TABLESPACE products_tsp datafile size 100m autoextend on next 10M maxsize unlimited extent management local uniform size 1m;
   
   Tablespace created.
   
   01:26:40 SQL> 
   01:26:40 SQL> REM
   01:26:40 SQL> REM Create Sharded and Duplicated tables
   01:26:40 SQL> REM
   01:26:40 SQL> connect app_schema/app_schema@catapdb
   Connected.
   01:26:40 SQL> alter session enable shard ddl;
   
   Session altered.
   
   01:26:40 SQL> REM
   01:26:40 SQL> REM Create a Sharded table for Customers	(Root table)
   01:26:40 SQL> REM
   01:26:40 SQL> CREATE SHARDED TABLE Customers
   01:26:40   2  (
   01:26:40   3  	CustId	    VARCHAR2(60) NOT NULL,
   01:26:40   4  	FirstName   VARCHAR2(60),
   01:26:40   5  	LastName    VARCHAR2(60),
   01:26:40   6  	Class	    VARCHAR2(10),
   01:26:40   7  	Geo	    VARCHAR2(8),
   01:26:40   8  	CustProfile VARCHAR2(4000),
   01:26:40   9  	Passwd	    RAW(60),
   01:26:40  10  	CONSTRAINT pk_customers PRIMARY KEY (CustId),
   01:26:40  11  	CONSTRAINT json_customers CHECK (CustProfile IS JSON)
   01:26:40  12  ) TABLESPACE SET TSP_SET_1
   01:26:40  13  PARTITION BY CONSISTENT HASH (CustId) PARTITIONS AUTO;
   
   Table created.
   
   01:26:41 SQL> 
   01:26:41 SQL> REM
   01:26:41 SQL> REM Create a Sharded table for Orders
   01:26:41 SQL> REM
   01:26:41 SQL> CREATE SHARDED TABLE Orders
   01:26:41   2  (
   01:26:41   3  	OrderId     INTEGER NOT NULL,
   01:26:41   4  	CustId	    VARCHAR2(60) NOT NULL,
   01:26:41   5  	OrderDate   TIMESTAMP NOT NULL,
   01:26:41   6  	SumTotal    NUMBER(19,4),
   01:26:41   7  	Status	    CHAR(4),
   01:26:41   8  	constraint  pk_orders primary key (CustId, OrderId),
   01:26:41   9  	constraint  fk_orders_parent foreign key (CustId)
   01:26:41  10  	  references Customers on delete cascade
   01:26:41  11  ) partition by reference (fk_orders_parent);
   
   Table created.
   
   01:26:41 SQL> 
   01:26:41 SQL> REM
   01:26:41 SQL> REM Create the sequence used for the OrderId column
   01:26:41 SQL> REM
   01:26:41 SQL> CREATE SEQUENCE Orders_Seq;
   
   Sequence created.
   
   01:26:41 SQL> 
   01:26:41 SQL> REM
   01:26:41 SQL> REM Create a Sharded table for LineItems
   01:26:41 SQL> REM
   01:26:41 SQL> CREATE SHARDED TABLE LineItems
   01:26:41   2  (
   01:26:41   3  	OrderId     INTEGER NOT NULL,
   01:26:41   4  	CustId	    VARCHAR2(60) NOT NULL,
   01:26:41   5  	ProductId   INTEGER NOT NULL,
   01:26:41   6  	Price	    NUMBER(19,4),
   01:26:41   7  	Qty	    NUMBER,
   01:26:41   8  	constraint  pk_items primary key (CustId, OrderId, ProductId),
   01:26:41   9  	constraint  fk_items_parent foreign key (CustId, OrderId)
   01:26:41  10  	  references Orders on delete cascade
   01:26:41  11  ) partition by reference (fk_items_parent);
   
   Table created.
   
   01:26:41 SQL> 
   01:26:41 SQL> REM
   01:26:41 SQL> REM Create Duplicated table for Products
   01:26:41 SQL> REM
   01:26:41 SQL> CREATE DUPLICATED TABLE Products
   01:26:41   2  (
   01:26:41   3  	ProductId  INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
   01:26:41   4  	Name	   VARCHAR2(128),
   01:26:41   5  	DescrUri   VARCHAR2(128),
   01:26:41   6  	LastPrice  NUMBER(19,4)
   01:26:41   7  ) TABLESPACE products_tsp;
   
   Table created.
   
   01:26:41 SQL> 
   01:26:41 SQL> REM
   01:26:41 SQL> REM Create functions for Password creation and checking â€“ used by the REM demo loader application
   01:26:41 SQL> REM
   01:26:41 SQL> 
   01:26:41 SQL> CREATE OR REPLACE FUNCTION PasswCreate(PASSW IN RAW)
   01:26:41   2  	RETURN RAW
   01:26:41   3  IS
   01:26:41   4  	Salt RAW(8);
   01:26:41   5  BEGIN
   01:26:41   6  	Salt := DBMS_CRYPTO.RANDOMBYTES(8);
   01:26:41   7  	RETURN UTL_RAW.CONCAT(Salt, DBMS_CRYPTO.HASH(UTL_RAW.CONCAT(Salt, PASSW), DBMS_CRYPTO.HASH_SH256));
   01:26:41   8  END;
   01:26:41   9  /
   
   Function created.
   
   01:26:41 SQL> 
   01:26:41 SQL> CREATE OR REPLACE FUNCTION PasswCheck(PASSW IN RAW, PHASH IN RAW)
   01:26:41   2  	RETURN INTEGER IS
   01:26:41   3  BEGIN
   01:26:41   4  	RETURN UTL_RAW.COMPARE(
   01:26:41   5  	    DBMS_CRYPTO.HASH(UTL_RAW.CONCAT(UTL_RAW.SUBSTR(PHASH, 1, 8), PASSW), DBMS_CRYPTO.HASH_SH256),
   01:26:41   6  	    UTL_RAW.SUBSTR(PHASH, 9));
   01:26:41   7  END;
   01:26:41   8  /
   
   Function created.
   
   01:26:41 SQL> 
   01:26:41 SQL> REM
   01:26:41 SQL> REM
   01:26:41 SQL> select table_name from user_tables;
   
   TABLE_NAME
   --------------------------------------------------------------------------------
   CUSTOMERS
   ORDERS
   LINEITEMS
   PRODUCTS
   MLOG$_PRODUCTS
   RUPD$_PRODUCTS
   
   6 rows selected.
   
   01:26:41 SQL> REM
   01:26:41 SQL> REM
   01:26:41 SQL> spool off
   01:26:41 SQL> 
   ```
   

   
6. The shard app demo schema is created. Exit the sqlplus.

   ```
   01:26:41 SQL> exit
   Disconnected from Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
   Version 19.7.0.0.0
   [oracle@cata ~]$
   ```

   

## **Step 2:** Verify the Shard App Schema

1. Switch to the GSM environment, run GDSCTL.

   ```
   [oracle@cata ~]$ . ./gsm.sh 
   
   [oracle@cata ~]$ gdsctl
   GDSCTL: Version 19.0.0.0.0 - Production on Mon Nov 30 01:41:47 GMT 2020
   
   Copyright (c) 2011, 2019, Oracle.  All rights reserved.
   
   Welcome to GDSCTL, type "help" for information.
   
   Current GSM is set to SHARDDIRECTOR1
   GDSCTL> 
   ```

   

2. Run the following commands to observe that there are no failures during the creation of tablespaces.

   ```
   GDSCTL> show ddl
   Catalog connection is established
   id      DDL Text                                 Failed shards 
   --      --------                                 ------------- 
   9       grant dba to app_schema                                
   10      CREATE TABLESPACE SET  TSP_SET_1 usin...               
   11      CREATE TABLESPACE products_tsp datafi...               
   12      CREATE SHARDED TABLE Customers (   Cu...               
   13      CREATE SHARDED TABLE Orders (   Order...               
   14      CREATE SEQUENCE Orders_Seq                             
   15      CREATE SHARDED TABLE LineItems (   Or...               
   16      CREATE MATERIALIZED VIEW "APP_SCHEMA"...               
   17      CREATE OR REPLACE FUNCTION PasswCreat...               
   18      CREATE OR REPLACE FUNCTION PasswCheck...               
   
   GDSCTL> 
   ```

   

3. Run the config commands as shown below for each of the shards and verify if there are any DDL error.

   ```
   GDSCTL> config shard -shard shd1_shdpdb1
   Name: shd1_shdpdb1
   Shard Group: shardgroup_primary
   Status: Ok
   State: Deployed
   Region: region1
   Connection string: shd1:1521/shdpdb1
   SCAN address: 
   ONS remote port: 0
   Disk Threshold, ms: 20
   CPU Threshold, %: 75
   Version: 19.0.0.0
   Failed DDL: 
   DDL Error: ---
   Failed DDL id: 
   Availability: ONLINE
   Rack: 
   
   
   Supported services
   ------------------------
   Name                                                            Preferred Status    
   ----                                                            --------- ------    
   oltp_rw_srvc                                                    Yes       Enabled   
   
   GDSCTL> config shard -shard shd2_shdpdb2
   Name: shd2_shdpdb2
   Shard Group: shardgroup_primary
   Status: Ok
   State: Deployed
   Region: region1
   Connection string: shd2:1521/shdpdb2
   SCAN address: 
   ONS remote port: 0
   Disk Threshold, ms: 20
   CPU Threshold, %: 75
   Version: 19.0.0.0
   Failed DDL: 
   DDL Error: ---
   Failed DDL id: 
   Availability: ONLINE
   Rack: 
   
   
   Supported services
   ------------------------
   Name                                                            Preferred Status    
   ----                                                            --------- ------    
   oltp_rw_srvc                                                    Yes       Enabled   
   
   GDSCTL> 
   ```

   

4. Show the created chunks.

   ```
   GDSCTL> config chunks
   Chunks
   ------------------------
   Database                      From      To        
   --------                      ----      --        
   shd1_shdpdb1                  1         6         
   shd2_shdpdb2                  7         12        
   
   GDSCTL> 
   ```

   

5. Exit GDSCTL.

   ```
   GDSCTL> exit
   [oracle@cata ~]$ 
   ```

   

6. Connect to the shard pdb1.

   ```
   [oracle@cata ~]$ <copy>sqlplus sys/Ora_DB4U@shd1:1521/shdpdb1 as sysdba</copy>
   
   SQL*Plus: Release 19.0.0.0.0 - Production on Mon Nov 30 02:01:17 2020
   Version 19.3.0.0.0
   
   Copyright (c) 1982, 2019, Oracle.  All rights reserved.
   
   
   Connected to:
   Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
   Version 19.7.0.0.0
   
   SQL> 
   ```

   

7. Check the created tablespace set.

   ```
   SQL> <copy>select TABLESPACE_NAME, BYTES/1024/1024 MB from sys.dba_data_files order by tablespace_name;</copy>
   
   TABLESPACE_NAME 		       MB
   ------------------------------ ----------
   C001TSP_SET_1			      100
   C002TSP_SET_1			      100
   C003TSP_SET_1			      100
   C004TSP_SET_1			      100
   C005TSP_SET_1			      100
   C006TSP_SET_1			      100
   PRODUCTS_TSP			      100
   SYSAUX				      420
   SYSTEM				      310
   TSP_SET_1			      100
   UNDOTBS1			      165
   
   TABLESPACE_NAME 		       MB
   ------------------------------ ----------
   USERS					5
   
   12 rows selected.
   
   SQL> 
   ```

   

8. Verify that the chunks and chunk tablespaces are created.

   ```
   SQL> set linesize 140
   SQL> column table_name format a20
   SQL> column tablespace_name format a20
   SQL> column partition_name format a20
   SQL> select table_name, partition_name, tablespace_name from dba_tab_partitions where tablespace_name like 'C%TSP_SET_1' order by tablespace_name;
   
   TABLE_NAME	     PARTITION_NAME	  TABLESPACE_NAME
   -------------------- -------------------- --------------------
   ORDERS		     CUSTOMERS_P1	  C001TSP_SET_1
   CUSTOMERS	     CUSTOMERS_P1	  C001TSP_SET_1
   LINEITEMS	     CUSTOMERS_P1	  C001TSP_SET_1
   CUSTOMERS	     CUSTOMERS_P2	  C002TSP_SET_1
   LINEITEMS	     CUSTOMERS_P2	  C002TSP_SET_1
   ORDERS		     CUSTOMERS_P2	  C002TSP_SET_1
   CUSTOMERS	     CUSTOMERS_P3	  C003TSP_SET_1
   ORDERS		     CUSTOMERS_P3	  C003TSP_SET_1
   LINEITEMS	     CUSTOMERS_P3	  C003TSP_SET_1
   ORDERS		     CUSTOMERS_P4	  C004TSP_SET_1
   CUSTOMERS	     CUSTOMERS_P4	  C004TSP_SET_1
   
   TABLE_NAME	     PARTITION_NAME	  TABLESPACE_NAME
   -------------------- -------------------- --------------------
   LINEITEMS	     CUSTOMERS_P4	  C004TSP_SET_1
   CUSTOMERS	     CUSTOMERS_P5	  C005TSP_SET_1
   LINEITEMS	     CUSTOMERS_P5	  C005TSP_SET_1
   ORDERS		     CUSTOMERS_P5	  C005TSP_SET_1
   CUSTOMERS	     CUSTOMERS_P6	  C006TSP_SET_1
   LINEITEMS	     CUSTOMERS_P6	  C006TSP_SET_1
   ORDERS		     CUSTOMERS_P6	  C006TSP_SET_1
   
   18 rows selected.
   
   SQL> 
   ```

   

9. Connect to the shard pdb2.

   ```
   SQL> <copy>connect sys/Ora_DB4U@shd2:1521/shdpdb2 as sysdba</copy>
   Connected.
   SQL>
   ```

   

10. Check the created tablespace set.

    ```
    SQL> <copy>select TABLESPACE_NAME, BYTES/1024/1024 MB from sys.dba_data_files order by tablespace_name;</copy>
    
    TABLESPACE_NAME 		       MB
    ------------------------------ ----------
    C007TSP_SET_1			      100
    C008TSP_SET_1			      100
    C009TSP_SET_1			      100
    C00ATSP_SET_1			      100
    C00BTSP_SET_1			      100
    C00CTSP_SET_1			      100
    PRODUCTS_TSP			      100
    SYSAUX				      440
    SYSTEM				      310
    TSP_SET_1			      100
    UNDOTBS1			      165
    
    TABLESPACE_NAME 		       MB
    ------------------------------ ----------
    USERS					5
    
    12 rows selected.
    
    SQL> 
    ```

    

11. Verify that the chunks and chunk tablespaces are created.

    ```
    SQL> set linesize 140
    SQL> column table_name format a20
    SQL> column tablespace_name format a20
    SQL> column partition_name format a20
    SQL> select table_name, partition_name, tablespace_name from dba_tab_partitions where tablespace_name like 'C%TSP_SET_1' order by tablespace_name;
    
    TABLE_NAME	     PARTITION_NAME	  TABLESPACE_NAME
    -------------------- -------------------- --------------------
    ORDERS		     CUSTOMERS_P7	  C007TSP_SET_1
    CUSTOMERS	     CUSTOMERS_P7	  C007TSP_SET_1
    LINEITEMS	     CUSTOMERS_P7	  C007TSP_SET_1
    CUSTOMERS	     CUSTOMERS_P8	  C008TSP_SET_1
    LINEITEMS	     CUSTOMERS_P8	  C008TSP_SET_1
    ORDERS		     CUSTOMERS_P8	  C008TSP_SET_1
    CUSTOMERS	     CUSTOMERS_P9	  C009TSP_SET_1
    ORDERS		     CUSTOMERS_P9	  C009TSP_SET_1
    LINEITEMS	     CUSTOMERS_P9	  C009TSP_SET_1
    ORDERS		     CUSTOMERS_P10	  C00ATSP_SET_1
    CUSTOMERS	     CUSTOMERS_P10	  C00ATSP_SET_1
    
    TABLE_NAME	     PARTITION_NAME	  TABLESPACE_NAME
    -------------------- -------------------- --------------------
    LINEITEMS	     CUSTOMERS_P10	  C00ATSP_SET_1
    CUSTOMERS	     CUSTOMERS_P11	  C00BTSP_SET_1
    LINEITEMS	     CUSTOMERS_P11	  C00BTSP_SET_1
    ORDERS		     CUSTOMERS_P11	  C00BTSP_SET_1
    CUSTOMERS	     CUSTOMERS_P12	  C00CTSP_SET_1
    LINEITEMS	     CUSTOMERS_P12	  C00CTSP_SET_1
    ORDERS		     CUSTOMERS_P12	  C00CTSP_SET_1
    
    18 rows selected.
    
    SQL> 
    ```

    

12. Connect to the shardcatalog.

    ```
    SQL> <copy>connect sys/Ora_DB4U@cata:1521/catapdb as sysdba</copy>
    Connected.
    SQL> 
    ```

    

13.  Query the `gsmadmin_internal.chunk_loc` table to observe that the chunks are uniformly distributed.

    ```
    SQL> column shard format a40
    SQL> select a.name Shard,count( b.chunk_number) Number_of_Chunks from gsmadmin_internal.database a, gsmadmin_internal.chunk_loc b where a.database_num=b.database_num group by a.name;
    
    SHARD					 NUMBER_OF_CHUNKS
    ---------------------------------------- ----------------
    shd1_shdpdb1						6
    shd2_shdpdb2						6
    
    SQL> 
    ```

    

14. Connect into the app_schema/app_schema on the catadb, shard1, shard2 databases and verify that the sharded and duplicated tables are created.

    ```
    SQL> connect app_schema/app_schema@cata:1521/catapdb
    Connected.
    SQL> select table_name from user_tables;
    
    TABLE_NAME
    --------------------------------------------------------------------------------
    CUSTOMERS
    ORDERS
    LINEITEMS
    PRODUCTS
    MLOG$_PRODUCTS
    RUPD$_PRODUCTS
    
    6 rows selected.
    
    SQL> connect app_schema/app_schema@shd1:1521/shdpdb1
    Connected.
    SQL> select table_name from user_tables;
    
    TABLE_NAME
    --------------------------------------------------------------------------------
    CUSTOMERS
    ORDERS
    LINEITEMS
    PRODUCTS
    USLOG$_PRODUCTS
    
    SQL> connect app_schema/app_schema@shd2:1521/shdpdb2
    Connected.
    SQL> select table_name from user_tables;
    
    TABLE_NAME
    --------------------------------------------------------------------------------
    CUSTOMERS
    ORDERS
    LINEITEMS
    PRODUCTS
    USLOG$_PRODUCTS
    
    SQL> 
    ```

    

15. Exit the sqlplus.

    ```
    SQL> exit
    Disconnected from Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
    Version 19.7.0.0.0
    [oracle@cata ~]$
    ```

    
